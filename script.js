const data = {
    "Ascension (Level 90)": [
        { name: "Varunada Lazurite Gemstone", count: 6, img: "https://paimon.moe/images/items/varunada_lazurite_gemstone.png" },
        { name: "Varunada Lazurite Chunk", count: 9, img: "https://paimon.moe/images/items/varunada_lazurite_chunk.png" },
        { name: "Varunada Lazurite Fragment", count: 9, img: "https://paimon.moe/images/items/varunada_lazurite_chunk.png" },
        { name: "Varunada Lazurite Sliver", count: 1, img: "https://paimon.moe/images/items/varunada_lazurite_chunk.png" },
        { name: "Slime Condensate", count: 18, img: "https://paimon.moe/images/items/slime_condensate.png" },
        { name: "Slime Secretions", count: 30, img: "https://paimon.moe/images/items/slime_secretions.png" },
        { name: "Slime Concentrate", count: 36, img: "https://paimon.moe/images/items/slime_concentrate.png" },
        { name: "Radiant Antler", count: 46, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/269e8d6724fd4b6f9df529c8d03025d51764684746.png?x-oss-process=image/format,webp" },
        { name: "Winter Icelea", count: 168, note: "NEW Nod-Krai Specialty", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/77caabcfc7a6461eb67052d6e0f643b71764765881.webp?x-oss-process=image/format,webp" },
        { name: "Wanderer's Advice", count: "3", img: "https://static.wikia.nocookie.net/gensin-impact/images/6/60/Item_Wanderer%27s_Advice.png/revision/latest?cb=20201116222406" },
        { name: "Hero's Wit", count: "418", img: "https://paimon.moe/images/items/heros_wit.png" },
        { name: "Mora", count: "2,092,400", img: "https://paimon.moe/images/items/mora.png" }
    ],
    "Talents": [
        { name: "Teachings of Moonlight", count: 9, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/97ba4eb2235143cfa085898f7c5820ad1764684746.png?x-oss-process=image/format,webp" },
        { name: "Guide to Moonlight", count: 63, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/3ae406905acc4ce49be3ccb509543aec1764684746.png?x-oss-process=image/format,webp" },
        { name: "Philosophies of Moonlight", count: 114, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/eeb1b7174fb448858b2e80a81e97f6531764684748.png?x-oss-process=image/format,webp" },
        { name: "Crown of Insight", count: 3, img: "https://paimon.moe/images/items/crown_of_insight.png" },
        { name: "???", count: 18, note: "New Weekly Drop", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/2ff5c8abe3b94573b7116c3c73e4981d1764765727.webp?x-oss-process=image/format,webp" },
        { name: "Slime Condensate", count: 18, img: "https://paimon.moe/images/items/slime_condensate.png" },
        { name: "Slime Secretions", count: 66, img: "https://paimon.moe/images/items/slime_secretions.png" },
        { name: "Slime Concentrate", count: 93, img: "https://paimon.moe/images/items/slime_concentrate.png" },
        { name: "Mora", count: "4,957,500", img: "https://paimon.moe/images/items/mora.png" }
    ],
    "Weapon: Nocturne's Curtain Call": [
        { name: "Sundered Glory of the Far-North Scions", count: 5, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/9761934dbfe74fec8b501b2f5163b7981764684746.png?x-oss-process=image/format,webp" },
        { name: "Unyielding Delusion of the Far-North Scions", count: 14, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/69233087036249ce969f96b7a605cb951764684748.png?x-oss-process=image/format,webp" },
        { name: "Oblation of the Far-North Scions", count: 14, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/a135cd9995a644e9b94c8d97c9b4535f1764684746.png?x-oss-process=image/format,webp" },
        { name: "Aureate Radiance of the Far-North Scions", count: 6, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/38b8278c46264a83a1f3c28973ccdb761764684746.png?x-oss-process=image/format,webp" },
        { name: "Fractured Eye of the Deep Shadow", count: 23, note: "New Mob Boss Drop", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/3b02d64a31494f13978c1489a63a1d8a1764913337.webp?x-oss-process=image/format,webp" },
        { name: "Aberrant Core of the Deep Shadow", count: 27, note: "New Mob Boss Drop", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/b843ae28d45f4e6c9a5cba318054a49f1764913316.webp?x-oss-process=image/format,webp" },
        { name: "Beak of the Deep Shadow", count: 41, note: "New Mob Boss Drop", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/14812f684a614e1fbec0a7e30198a8221764913294.webp?x-oss-process=image/format,webp" },
        { name: "Tattered Warrant", count: 15, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/9b33288ddf35436ebe41461aa96105241764684746.png?x-oss-process=image/format,webp" },
        { name: "Immaculate Warrant", count: 23, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/6ac5f65e0226457da60a4fb42de1e60e1764684746.png?x-oss-process=image/format,webp" },
        { name: "Frost-Etched Warrant", count: 27, note: "", img: "https://shop.ldrescdn.com/rms/ld-space/process/img/f2dc24671d4e45e1b6d67bbd07e63e861764684747.png?x-oss-process=image/format,webp" },
        { name: "Mystic Enhancement Ore", count: "709", img: "https://static.wikia.nocookie.net/gensin-impact/images/5/55/Item_Mystic_Enhancement_Ore.png/revision/latest?cb=20210106073921" },
        { name: "Mora", count: "753,000", img: "https://paimon.moe/images/items/mora.png" }
    ]
};

const PREFIX = "columbina_final_";
const app = document.getElementById('app');
const statusEl = document.getElementById('save-status');

function render() {
    app.innerHTML = '';

    for (const [section, items] of Object.entries(data)) {
        const title = document.createElement('div');
        title.className = 'section-title';
        title.textContent = section;
        app.appendChild(title);

        const grid = document.createElement('div');
        grid.className = 'checklist-grid';

        items.forEach((item, index) => {
            const id = `${PREFIX}${section.split(' ')[0]}_${index}`;
            const isChecked = localStorage.getItem(id) === 'true';

            const card = document.createElement('div');
            card.className = `card ${isChecked ? 'completed' : ''}`;
            card.innerHTML = `
                <img src="${item.img}" class="item-icon" alt="${item.name}">
                <div class="item-details">
                    <span class="item-name">${item.name}</span>
                    <div class="item-count">x ${item.count} ${item.note ? `<span class="badge">${item.note}</span>` : ''}</div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''} onchange="toggle('${id}', this)">
                    <label for="${id}"></label>
                </div>
            `;
            grid.appendChild(card);
        });
        app.appendChild(grid);
    }
}

// Toggle and Auto-Save
window.toggle = (id, el) => {
    localStorage.setItem(id, el.checked);
    render();
    showSaveStatus();
};

// Reset
document.getElementById('resetBtn').addEventListener('click', () => {
    if(confirm("Reset all tracking data?")) {
        Object.keys(localStorage).forEach(k => {
            if(k.startsWith(PREFIX)) localStorage.removeItem(k);
        });
        render();
    }
});

// Show "Auto-saved" feedback
function showSaveStatus() {
    statusEl.style.opacity = '1';
    setTimeout(() => {
        statusEl.style.opacity = '0';
    }, 1500);
}

// Initial Render
render();